# AutoMovie 项目主文档

## 项目整体概述

AutoMovie 是一个基于 Django 的自动化视频制作平台，它就像一个智能的视频工厂，能够帮助用户从文字内容自动生成完整的视频作品。

### 这个项目是做什么的？

简单来说，AutoMovie 可以：
1. **把文字变成视频** - 你输入一段文字，它能自动生成配套的图片、语音和视频
2. **智能内容生成** - 使用 AI 技术自动创作文案、生成图片、合成语音
3. **一站式制作** - 从创意到成品，所有步骤都在一个平台完成
4. **项目化管理** - 可以创建多个项目，每个项目独立管理自己的素材和设置

### 主要特色功能

- **AI 文案生成**：输入主题，自动生成完整的视频脚本
- **AI 图片生成**：根据文案内容自动生成配套图片
- **AI 语音合成**：将文字转换为自然的语音旁白
- **自动视频拼接**：将图片、语音、字幕自动组合成完整视频
- **项目管理**：支持多项目并行，每个项目独立存储

## 项目架构说明

### 整体架构

AutoMovie 采用经典的 Web 应用架构，主要分为三层：

```
前端界面层 (HTML/CSS/JavaScript)
    ↓
业务逻辑层 (Django Views)
    ↓
数据存储层 (文件系统 + SQLite)
```

### 技术栈

- **后端框架**：Django 4.2.7 - 这是一个 Python 网站开发框架，负责处理用户请求
- **前端技术**：HTML + CSS + JavaScript - 负责用户界面显示和交互
- **数据库**：SQLite - 轻量级数据库，存储用户数据和项目信息
- **AI 集成**：ComfyUI - 专业的 AI 图像生成工具
- **音频处理**：librosa + soundfile - 处理音频文件的 Python 库
- **视频处理**：FFMPEG - 专业的视频处理工具

## 各个模块的作用和关系

### 1. 核心应用模块 (Mainsite/)

这是项目的大脑，负责：
- **settings.py** - 项目的总配置文件，就像房子的设计图纸
- **urls.py** - 网址路由配置，告诉系统用户访问不同网址时该做什么
- **views.py** - 业务逻辑处理，就像餐厅的厨师，接收订单并制作菜品
- **wsgi.py** - Web 服务器接口，让项目能在服务器上运行

### 2. 通用工具模块 (common/)

这是项目的工具箱，包含各种专业工具：

- **audio_processor.py** - 音频处理工具
  - 去除音频中的无声部分
  - 计算音频时长
  - 添加前后停顿
  
- **video_processor.py** - 视频处理工具
  - 将图片和音频合成视频
  - 添加字幕和特效
  - 视频片段拼接
  
- **comfyui_client.py** - AI 图像生成客户端
  - 连接 ComfyUI 服务
  - 发送图像生成请求
  - 下载生成的图片

- **子目录功能**：
  - **Workflow/** - 存放 ComfyUI 工作流配置文件
  - **text_gen/** - 文案生成相关的 prompt 模板
  - **text_fmt/** - 文案格式化模板
  - **first_sentence/** - 开头句生成模板
  - **back_mus/** - 背景音乐文件
  - **Fonts/** - 字体文件

### 3. 前端界面模块 (templates/ + static/)

- **templates/** - HTML 模板文件
  - **base.html** - 基础模板，定义网站的整体布局
  - **index.html** - 首页
  - **project.html** - 项目管理页面
  - **text_gen.html** - 文案生成页面
  - **image_gen.html** - 图片生成页面
  - **audio_gen.html** - 语音生成页面
  - **video_maker.html** - 视频制作页面
  - **auto_video.html** - 自动视频生成页面
  - **system_config.html** - 系统配置页面

- **static/** - 静态资源文件
  - **css/** - 样式文件，控制网站外观
  - **js/** - JavaScript 文件，控制网站交互功能

### 4. 项目存储模块 (projects/)

这个目录存储所有用户创建的项目，每个项目都有自己的文件夹，包含：
- **paper.ini** - 项目的文案内容
- **paper.json** - 格式化后的文案数据
- **parameter.ini** - 项目参数配置
- **images/** - 生成的图片文件
- **audios/** - 生成的音频文件
- **videos/** - 生成的视频文件

## 数据流向说明

### 典型的视频制作流程

1. **项目创建阶段**
   ```
   用户输入项目名称 → Django 创建项目文件夹 → 初始化配置文件
   ```

2. **文案生成阶段**
   ```
   用户输入主题 → AI 生成文案 → 保存到 paper.ini → 格式化为 paper.json
   ```

3. **图片生成阶段**
   ```
   读取 paper.json → 提取每句话内容 → 发送给 ComfyUI → 生成图片 → 保存到 images/
   ```

4. **语音生成阶段**
   ```
   读取 paper.json → 提取文字内容 → 调用语音合成 API → 生成音频 → 保存到 audios/
   ```

5. **视频合成阶段**
   ```
   读取图片和音频 → 使用 FFMPEG 合成 → 添加字幕和特效 → 生成最终视频
   ```

### 数据存储结构

```
projects/
├── 项目A/
│   ├── paper.ini          # 原始文案
│   ├── paper.json         # 格式化文案
│   ├── parameter.ini      # 项目配置
│   ├── images/            # 图片文件夹
│   │   ├── script_1.png
│   │   └── script_2.png
│   ├── audios/            # 音频文件夹
│   │   ├── script_1.wav
│   │   └── script_2.wav
│   └── videos/            # 视频文件夹
│       └── final_video.mp4
└── 项目B/
    └── ...
```

### 配置文件系统

- **config.ini** - 全局系统配置
  - API 密钥和地址
  - ComfyUI 服务器地址
  - 默认参数设置
  
- **parameter.ini** - 项目级配置
  - 视频参数（分辨率、帧率等）
  - 字幕样式设置
  - 音频处理参数

## 核心工作原理

### 1. Web 请求处理流程

```
用户访问网址 → urls.py 路由匹配 → views.py 处理逻辑 → 返回 HTML 页面
```

### 2. AJAX 异步处理

大部分功能使用 AJAX 技术，让用户无需刷新页面就能看到结果：

```
前端 JavaScript → 发送 AJAX 请求 → Django 视图处理 → 返回 JSON 数据 → 前端更新界面
```

### 3. 文件管理机制

- 所有用户文件都存储在 `projects/` 目录下
- 每个项目有独立的文件夹
- 使用相对路径确保跨平台兼容性
- 自动创建必要的目录结构

### 4. 错误处理和日志

- 使用 Python logging 模块记录操作日志
- 日志文件存储在 `logs/` 目录
- 前端显示用户友好的错误信息
- 后端记录详细的技术错误信息

## 扩展性设计

### 1. 模块化架构

每个功能模块都是独立的，可以单独修改或替换：
- 音频处理模块可以替换不同的语音合成服务
- 图像生成模块可以接入不同的 AI 服务
- 视频处理模块可以使用不同的编码器

### 2. 配置驱动

大部分功能参数都通过配置文件控制，无需修改代码就能调整：
- API 服务地址
- 生成参数
- 界面设置

### 3. 插件化设计

- Prompt 模板可以自由添加和修改
- 工作流配置支持自定义
- 字体和背景音乐可以扩展

这个架构设计让 AutoMovie 既功能强大又易于维护和扩展，无论是个人用户还是开发者都能轻松使用和定制。