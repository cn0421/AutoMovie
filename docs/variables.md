# AutoMovie 变量文档

## 概述

本文档详细介绍 AutoMovie 项目中的重要变量、配置项和常量。变量就像是程序的记忆，存储着各种重要信息，包括系统设置、用户数据、临时状态等。

## Django 配置变量 (Mainsite/settings.py)

### 基础配置变量

#### `BASE_DIR`
- **类型**：Path 对象
- **值**：`Path(__file__).resolve().parent.parent`
- **用途**：项目根目录路径
- **说明**：所有其他路径都基于这个目录计算，确保跨平台兼容性

#### `SECRET_KEY`
- **类型**：字符串
- **值**：`'django-insecure-uh%eo4n&-n#e4h04@+s%-jqb2fz-pgxi^)c9eq2nsf7s$%==$b'`
- **用途**：Django 安全密钥
- **说明**：用于加密会话、CSRF 保护等安全功能
- **⚠️ 安全提醒**：生产环境中应该使用随机生成的密钥

#### `DEBUG`
- **类型**：布尔值
- **值**：`True`
- **用途**：调试模式开关
- **说明**：开启后显示详细错误信息，生产环境应设为 False

#### `ALLOWED_HOSTS`
- **类型**：列表
- **值**：`['*']`
- **用途**：允许访问的主机名列表
- **说明**：`['*']` 表示允许所有主机访问，生产环境应限制具体域名

### 应用配置变量

#### `INSTALLED_APPS`
- **类型**：列表
- **用途**：已安装的 Django 应用列表
- **包含的应用**：
  - `'django.contrib.admin'` - 管理后台
  - `'django.contrib.auth'` - 用户认证系统
  - `'django.contrib.contenttypes'` - 内容类型框架
  - `'django.contrib.sessions'` - 会话管理
  - `'django.contrib.messages'` - 消息框架
  - `'django.contrib.staticfiles'` - 静态文件管理
  - `'Mainsite'` - 项目主应用

#### `MIDDLEWARE`
- **类型**：列表
- **用途**：中间件配置，处理请求和响应的组件
- **包含的中间件**：
  - `SecurityMiddleware` - 安全中间件
  - `SessionMiddleware` - 会话中间件
  - `CommonMiddleware` - 通用中间件
  - `CsrfViewMiddleware` - CSRF 保护中间件
  - `AuthenticationMiddleware` - 认证中间件
  - `MessageMiddleware` - 消息中间件
  - `ClickjackingMiddleware` - 点击劫持保护中间件

### 数据库配置变量

#### `DATABASES`
- **类型**：字典
- **用途**：数据库连接配置
- **配置内容**：
  ```python
  {
      'default': {
          'ENGINE': 'django.db.backends.sqlite3',
          'NAME': BASE_DIR / 'db.sqlite3',
      }
  }
  ```
- **说明**：使用 SQLite 数据库，文件存储在项目根目录

### 静态文件配置变量

#### `STATIC_URL`
- **类型**：字符串
- **值**：`'static/'`
- **用途**：静态文件的 URL 前缀
- **说明**：浏览器访问静态文件时使用的路径前缀

#### `STATICFILES_DIRS`
- **类型**：列表
- **值**：`[BASE_DIR / 'static']`
- **用途**：静态文件搜索目录
- **说明**：Django 在这些目录中查找静态文件

#### `STATIC_ROOT`
- **类型**：Path 对象
- **值**：`BASE_DIR / 'staticfiles'`
- **用途**：静态文件收集目录
- **说明**：部署时所有静态文件会收集到这个目录

### 媒体文件配置变量

#### `MEDIA_URL`
- **类型**：字符串
- **值**：`'/media/'`
- **用途**：媒体文件的 URL 前缀
- **说明**：用户上传文件的访问路径前缀

#### `MEDIA_ROOT`
- **类型**：Path 对象
- **值**：`BASE_DIR / 'projects'`
- **用途**：媒体文件存储目录
- **说明**：所有用户项目文件都存储在这个目录下

### 模板配置变量

#### `TEMPLATES`
- **类型**：列表
- **用途**：模板引擎配置
- **重要配置**：
  - `'DIRS': [BASE_DIR / 'templates']` - 模板文件目录
  - `'APP_DIRS': True` - 在应用目录中查找模板

### 日志配置变量

#### `LOGS_DIR`
- **类型**：Path 对象
- **值**：`BASE_DIR / 'logs'`
- **用途**：日志文件存储目录
- **说明**：所有应用日志都存储在这个目录下

#### `LOGGING`
- **类型**：字典
- **用途**：详细的日志配置
- **主要组件**：
  - **formatters** - 日志格式定义
  - **handlers** - 日志处理器（文件、控制台）
  - **loggers** - 具体的日志记录器配置

## 系统配置变量 (config.ini)

### API 配置节 [API_CONFIG]

#### `api_key`
- **类型**：字符串
- **用途**：AI 服务的 API 密钥
- **说明**：用于访问文案生成、语音合成等 AI 服务
- **⚠️ 安全提醒**：这是敏感信息，不应该提交到版本控制

#### `api_base_url`
- **类型**：字符串
- **用途**：AI 服务的基础 URL
- **示例**：`https://api.openai.com/v1`
- **说明**：所有 AI API 请求的基础地址

#### `model_name`
- **类型**：字符串
- **用途**：使用的 AI 模型名称
- **示例**：`gpt-3.5-turbo`
- **说明**：指定用于文案生成的具体模型

### ComfyUI 配置节 [COMFYUI_CONFIG]

#### `comfyui_address`
- **类型**：字符串
- **用途**：ComfyUI 服务器地址
- **示例**：`http://127.0.0.1:8188/`
- **说明**：AI 图像生成服务的网络地址

#### `workflow_file`
- **类型**：字符串
- **用途**：默认工作流文件名
- **示例**：`default_workflow.json`
- **说明**：图像生成使用的工作流配置文件

### 系统配置节 [SYSTEM_CONFIG]

#### `default_project_path`
- **类型**：字符串
- **用途**：默认项目存储路径
- **说明**：新项目创建时的默认位置

#### `temp_dir`
- **类型**：字符串
- **用途**：临时文件目录
- **说明**：处理过程中临时文件的存储位置

#### `max_project_count`
- **类型**：整数
- **用途**：最大项目数量限制
- **说明**：防止创建过多项目占用磁盘空间

## 项目级配置变量 (parameter.ini)

### 视频配置节 [VIDEO_CONFIG]

#### `video_width`
- **类型**：整数
- **默认值**：1920
- **用途**：视频宽度（像素）
- **说明**：生成视频的水平分辨率

#### `video_height`
- **类型**：整数
- **默认值**：1080
- **用途**：视频高度（像素）
- **说明**：生成视频的垂直分辨率

#### `video_fps`
- **类型**：整数
- **默认值**：24
- **用途**：视频帧率（每秒帧数）
- **说明**：控制视频播放的流畅度

#### `video_codec`
- **类型**：字符串
- **默认值**：`libx264`
- **用途**：视频编码器
- **说明**：决定视频文件的压缩格式和质量

### 字幕配置节 [SUBTITLE_CONFIG]

#### `font_size`
- **类型**：整数
- **默认值**：50
- **用途**：字幕字体大小
- **说明**：控制字幕在视频中的显示大小

#### `font_color`
- **类型**：字符串
- **默认值**：`white`
- **用途**：字幕颜色
- **说明**：字幕文字的显示颜色

#### `font_position`
- **类型**：字符串
- **默认值**：`bottom`
- **用途**：字幕位置
- **说明**：字幕在视频中的显示位置

#### `stroke_color`
- **类型**：字符串
- **默认值**：`black`
- **用途**：字幕描边颜色
- **说明**：字幕文字的边框颜色，增强可读性

#### `stroke_width`
- **类型**：整数
- **默认值**：2
- **用途**：字幕描边宽度
- **说明**：字幕文字边框的粗细

### 音频配置节 [AUDIO_CONFIG]

#### `pre_pause`
- **类型**：浮点数
- **默认值**：0.5
- **用途**：音频前停顿时长（秒）
- **说明**：每段音频开始前的静音时间

#### `post_pause`
- **类型**：浮点数
- **默认值**：0.5
- **用途**：音频后停顿时长（秒）
- **说明**：每段音频结束后的静音时间

#### `silence_threshold`
- **类型**：浮点数
- **默认值**：0.01
- **用途**：静音检测阈值
- **说明**：低于此值的音频被认为是静音

### 淡入淡出配置节 [FADE_CONFIG]

#### `fade_in_duration`
- **类型**：浮点数
- **默认值**：0.5
- **用途**：淡入时长（秒）
- **说明**：图片出现时的渐显时间

#### `fade_out_duration`
- **类型**：浮点数
- **默认值**：0.5
- **用途**：淡出时长（秒）
- **说明**：图片消失时的渐隐时间

### 背景音乐配置节 [BGM_CONFIG]

#### `bgm_enabled`
- **类型**：布尔值
- **默认值**：false
- **用途**：是否启用背景音乐
- **说明**：控制视频是否添加背景音乐

#### `bgm_volume`
- **类型**：浮点数
- **默认值**：0.3
- **用途**：背景音乐音量（0-1之间）
- **说明**：背景音乐相对于主音频的音量比例

#### `bgm_file`
- **类型**：字符串
- **用途**：背景音乐文件名
- **说明**：使用的背景音乐文件路径

## 运行时变量

### 会话变量

#### `current_project`
- **存储位置**：Django session
- **类型**：字符串
- **用途**：当前打开的项目名称
- **说明**：记住用户当前正在编辑的项目

#### `project_path`
- **存储位置**：Django session
- **类型**：字符串
- **用途**：当前项目的完整路径
- **说明**：用于文件操作的完整路径

### 临时变量

#### `temp_files`
- **作用域**：VideoProcessor 实例
- **类型**：列表
- **用途**：记录临时文件路径
- **说明**：用于清理处理过程中产生的临时文件

#### `client_id`
- **作用域**：ComfyUIClient 实例
- **类型**：UUID 字符串
- **用途**：WebSocket 连接的客户端标识
- **说明**：确保 AI 服务能正确识别客户端

### 状态变量

#### `generation_status`
- **存储位置**：内存/缓存
- **类型**：字典
- **用途**：记录各种生成任务的状态
- **包含信息**：
  - 任务ID
  - 进度百分比
  - 当前状态（等待/进行中/完成/失败）
  - 错误信息（如果有）

## 环境变量

### 系统环境变量

#### `DJANGO_SETTINGS_MODULE`
- **类型**：字符串
- **值**：`Mainsite.settings`
- **用途**：指定 Django 配置模块
- **说明**：告诉 Django 使用哪个设置文件

#### `PYTHONPATH`
- **类型**：字符串
- **用途**：Python 模块搜索路径
- **说明**：确保 Python 能找到项目模块

### 可选环境变量

#### `COMFYUI_SERVER`
- **类型**：字符串
- **用途**：覆盖配置文件中的 ComfyUI 服务器地址
- **说明**：允许通过环境变量动态配置服务器地址

#### `API_KEY`
- **类型**：字符串
- **用途**：覆盖配置文件中的 API 密钥
- **说明**：更安全的 API 密钥配置方式

## 常量定义

### 文件路径常量

#### `DEFAULT_WORKFLOW_PATH`
- **值**：`common/Workflow/`
- **用途**：默认工作流文件目录

#### `DEFAULT_FONT_PATH`
- **值**：`common/Fonts/`
- **用途**：默认字体文件目录

#### `DEFAULT_BGM_PATH`
- **值**：`common/back_mus/`
- **用途**：默认背景音乐目录

### 默认值常量

#### `DEFAULT_VIDEO_RESOLUTION`
- **值**：`(1920, 1080)`
- **用途**：默认视频分辨率

#### `DEFAULT_VIDEO_FPS`
- **值**：`24`
- **用途**：默认视频帧率

#### `DEFAULT_AUDIO_SAMPLE_RATE`
- **值**：`44100`
- **用途**：默认音频采样率

### 限制常量

#### `MAX_FILE_SIZE`
- **值**：`100 * 1024 * 1024`  # 100MB
- **用途**：最大文件上传大小

#### `MAX_VIDEO_DURATION`
- **值**：`600`  # 10分钟
- **用途**：最大视频时长限制

#### `MAX_CONCURRENT_TASKS`
- **值**：`3`
- **用途**：最大并发任务数

## 变量命名规范

### 配置变量
- 使用小写字母和下划线
- 例如：`api_key`, `video_width`, `font_size`

### 常量
- 使用大写字母和下划线
- 例如：`DEFAULT_VIDEO_FPS`, `MAX_FILE_SIZE`

### 临时变量
- 使用小写字母和下划线
- 例如：`temp_files`, `client_id`

### 路径变量
- 统一使用 Path 对象或字符串
- 例如：`BASE_DIR`, `project_path`

## 配置管理最佳实践

### 1. 敏感信息保护
- API 密钥等敏感信息不应硬编码
- 使用环境变量或独立的配置文件
- 配置文件应添加到 .gitignore

### 2. 默认值设置
- 所有配置项都应有合理的默认值
- 使用 `fallback` 参数提供默认值

### 3. 配置验证
- 在使用配置前进行有效性检查
- 对关键配置项进行范围验证

### 4. 配置文档
- 为每个配置项提供清晰的说明
- 包含示例值和使用场景

这种变量管理方式确保了 AutoMovie 项目的灵活性、安全性和可维护性。